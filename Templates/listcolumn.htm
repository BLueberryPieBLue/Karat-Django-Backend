<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <title>在线投票</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="//{{ RequestHost}}{% static 'css/normalize.css' %}">
    <link rel="stylesheet" type="text/css" href="//{{ RequestHost}}{% static 'css/default.css' %}">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="//{{ RequestHost}}{% static 'lib/jquery1.9.1.min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="//{{ RequestHost}}{% static 'js/junkmailtest.js'%}"></script>
    <script src="//{{ RequestHost}}{% static 'js/mailformattest.js'%}"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style type="text/css">
        #gallery-wrapper {
            position: relative;
            max-width: 75%;
            width: 75%;
            margin: 50px auto;
        }
        
        img.thumb {
            width: 100%;
            max-width: 100%;
            height: auto;
        }
        
        .white-panel {
            position: absolute;
            background: white;
            border-radius: 5px;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3);
            padding: 10px;
        }
        
        .white-panel h1 {
            font-size: 1em;
        }
        
        .white-panel h1 a {
            color: #A92733;
        }
        
        .white-panel:hover {
            box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.5);
            margin-top: -5px;
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }
        
        a {
            color: black;
            text-decoration: none;
        }
    </style>
    <!--[if IE]>
		<script src="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>
	<![endif]-->
</head>

<body>
<!-- <div frag="面板1">
        <div frag="窗口1">
            <div frag="窗口内容"> -->
    <section id="gallery-wrapper">
        <article class="white-panel competitor">
            <img src="{% static 'img/1.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名1</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/2.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名2</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/3.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名3</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/5.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名4</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/6.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名5</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/7.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名6</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/8.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名7</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/9.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名8</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/10.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名9</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/11.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名10</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/12.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名11</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/13.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名12</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/14.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名13</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
        <article class="white-panel competitor">
            <img src="{% static 'img/15.jpg' %}" class="thumb">
            <h6>
                <span class="name">姓名14</span>&nbsp;<span class="sex">性别</span>&nbsp;<span class="classroom">软件工程学院</span>&nbsp;<span class="voted badge pull-right">0</span>
            </h6>
            <a href="http://www.runoob.com/bootstrap/bootstrap-wells.html">
                <p><small class="title">这里是简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍简短的介绍</small></p>
            </a>
        </article>
    </section>
    <!-- </div>
        </div>
    </div> -->
    <script src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
    <script src="{% static 'js/pinterest_grid.js' %}"></script>
    <script type="text/javascript">
        $(function() {
            $("#gallery-wrapper").pinterest_grid({
                no_columns: 4,
                padding_x: 10,
                padding_y: 10,
                margin_bottom: 50,
                single_column_breakpoint: 700
            });
        });
    </script>
    <footer class="related">
    </footer>
</body>
<script src="//{{ RequestHost}}/script/tools/getip.js"></script>
<script type="text/javascript" charset="utf-8">
    function makeAckJson() {
        comp=[];
        S="";
        $(".white-panel.competitor .name").each(function(index, selement) {
            comp.push($(this).text())
        });
        for (i=0;i<comp.length;i++){
            S=S+comp[i]+" ";
        }
        jsondata={"comp":S};
        console.log('jsondata:'+jsondata);
        return jsondata;
    }

    function adjustEqual(data) {
        var errmsg='获取最新得票失败';
        $.ajax({
            type: "POST",
            traditional: true,
            url: "//{{ RequestHost}}/EqualAdjust/",
            async: true,
            dataType: "json",
            timeout: 5000,
            data: data,
            success: function(data) {
                console.log(data);
                if (data['code']){
                    console.log("校验成功");
                }else{
                    console.log("校验失败");
                }
            },
            error: function(e) {
                console.dir("数据校验请求失败");
            }
        })
            $.ajax({
            type: "POST",
            traditional: true,
            url: "//{{ RequestHost}}/GetVote/",
            async: true,
            dataType: "json",
            timeout: 5000,
            data: null,
            success: function(data) {
                if(data['code'] == 1){
                    var str='';
                    for(var comp in data['s']){
                        var score=data['s'][comp];
                        $('.voted.badge.pull-right').filter(function(){
                            return $(this).parent().children(0).html() == comp;
                        }).html(score);
                    }
                }else{
                    console.log(errmsg)
                }
            },
            error: function(e) {
                   console.log(errmsg);
            }
        })
    }

    window.onload = function() {
        jsondata = makeAckJson();
        adjustEqual(jsondata);
        };
        // **************以上为向后台发送确认数据*******************

    $('.voted.badge.pull-right').click(function(){
        var obj=$(this);
        data={ competitorname:$(this).parent().children(0).html()};
        orivote=parseInt($(this).html());
        console.log(data,orivote)
        setVote(data,orivote,obj);
    });
    //**************************************投票*****************************************
    function setVote(data,orivote,obj) {
        $.ajax({
            type: "POST",
            url: "//{{ RequestHost}}/SetVote/",
            async: true,
            dataType: "json",
            timeout: 5000,
            data:data,
            success: function(data) {
                console.log(data);
                if (data.code == "1") {
                    console.log("投票成功");
                    obj.html(orivote+1);

                }else if (data.code == "0") {
                    console.log("投票请求失败");
                }else{
                    alert("您今天已达到投票次数上限5次");
                }
            },
            error: function() {
                console.log("请求异常");
            }
        })
     };
</script>

</html>